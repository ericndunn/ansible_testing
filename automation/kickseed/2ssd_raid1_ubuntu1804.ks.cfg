#Generated by Kickstart Configurator
#platform=AMD64 or Intel EM64T

#System language
# see /etc/default/locale
lang en_US.UTF-8
#Language modules to install
langsupport en_US
#System keyboard
keyboard us
#System mouse
mouse
#System timezone
timezone --utc America/New_York
#Root password
rootpw --disabled
#Initial user
user orchid --fullname "orchid" --iscrypted --password $1$lWztTfMi$4at/CmskkhlDyYmuBRCD60
#Reboot after installation
reboot
#Use text mode install
text
#Install OS instead of upgrade
install
#Use Web installation
url --url http://192.168.100.205/ubuntu

# Preseed testing
# Activate MDADM containers (Intel/DDF RAID)?
#preseed disk-detect	disk-detect/activate_mdadm	boolean	true
# Activate Serial ATA RAID devices?
#preseed disk-detect	disk-detect/activate_dmraid	boolean	true

#System bootloader configuration
bootloader --location=mbr 
#Clear the Master Boot Record
zerombr yes
#Partition clearing information
clearpart --all --initlabel 
#Disk partitioning information
#part / --fstype ext4 --size 1 --grow --asprimary 
#part swap --recommended 
#System authorization infomation
auth  --useshadow  --enablemd5 
#Network information
network --bootproto=dhcp
#Firewall configuration
firewall --disabled --ssh 
#Do not configure the X Window System
skipx

#Package install information
%packages
@ ubuntu-standard
@ openssh-server
@ ubuntu-desktop
debconf-utils
default-jdk
wget
curl
ansible
git
vim
nfs-common
rsync
mdadm
nano

%post

apt-get install --install-recommends linux-generic-hwe-16.04 xserver-xorg-hwe-16.04 -y

# Activate RAID1 on 2 SSD
#/sbin/sfdisk -A /dev/sda 1
#/sbin/sfdisk -A /dev/sdb 1
#/sbin/sfdisk -A /dev/md126
#/sbin/sfdisk -A /dev/sr0

#Pull Git repository
mkdir /jenkins
chmod -R 777 /jenkins
wget -O /jenkins/ansiblepull.sh ftp://192.168.102.42/pub/steelfin/ansiblepull.sh
chmod a+x /jenkins/ansiblepull.sh
/jenkins/ansiblepull.sh

echo '<html>' > /home/orchid/license.html 
echo '<head>' >> /home/orchid/license.html
echo '<meta http-equiv="refresh" content="0; url=ftp://192.168.102.42/pub/steelfin/serial/" />' >> /home/orchid/license.html
echo '</head>' >> /home/orchid/license.html
echo '</html>' >> /home/orchid/license.html

echo 'sudo rm -rf /jenkins ~/repos ~/license.html ~/cleanup.sh && sudo reboot' > /home/orchid/cleanup.sh
chmod 777 /home/orchid/cleanup.sh
     

